#labels Featured,Phase-Design,Phase-Implementation
#lulu messenger 协议 v2.0 不完整说明.

= lulu messenger 协议 v2.0 = 

本协议包括消息传输协议、数据传输控制协议和文件传输协议三部分。

本协议的消息传输和数据传输控制协议数据通过IP层中UDP协议传输。

本协议的文件传输协议部分通过IP层TCP协议传输。

协议数据格式

1. UDP消息协议数据格式：
    每一条UDP消息数据是一个Message对象，每个Message对象包含几个Profile对象，
    每个Profile对象代表一种消息类型，由协议号区别。
    Profile对象中存储着消息数据内容。数据内容分为通用数据内容和明确类型数据内容。
    通用数据内容以下称为属性，不同的属性由16位属性号和属性字符串组成。

 (1)Message对象数据格式：
    ｜Message长度(32位)｜Profile1｜Profile2｜......
    Message的32位长度是消息的总长度，包括长度本身。
		
    (2)Profile对象数据格式：
    ｜Profile协议号(16位)｜Profile长度(16位)｜Profile数据｜
    Profile的16位长度是后面数据的长度，不包括长度本身。

2.  Profile数据
    Profile数据有两种格式，一种是通用格式，一种是明确类型的格式。
    
    (1)明确类型的格式
    明确类型的格式,其格式由协议号确定，根据协议号解析数据内容。
    目前存在的明确类型Profile对象有：SN，Ack，Data，From，To。
    数据格式：｜数据对象1｜数据对象2｜......

    (2)通用格式
    通用格式,其格式是统一的，但解析时也要根据协议号确定是否是统一格式。
    数据格式：｜属性个数(16位)｜属性编号1(16位)｜字符串1｜属性编号2(16位)｜字符串2｜......

3.  完整消息数据格式：
    ｜消息长度(32位)｜
    ｜{Profile协议号(16位)｜Profile长度(16位)｜[数据对象1｜数据对象2｜......]}
    ｜{Profile协议号(16位)｜Profile长度(16位)｜[属性个数(16位)｜属性编号1(16位)｜字符串1｜属性编号2(16位)｜字符串2｜......]}
    ｜......

4. 明确类型Profile举例：Message对象编号SN
    编号SN对象数据内容只有一个64位长整形的数据。
    ｜SN协议号(16位)｜SN长度(16位)=8Bytes｜64位长整形编号｜

5. 通用Profile格式举例：对话消息Profile
    对话消息有目前有两种类型，非压缩的和压缩的，称为TextNormal和TextZip，都通用格式的Profile。
    
    (1)非压缩的有两个属性，一个是时间戳TimeStamp｜日期时间字符串，一个是TextContent｜消息内容字符串。
    
    (2)压缩的有三个属性，一个是时间戳TimeStamp｜日期时间字符串，一个是压缩前消息长度TextLength｜长度字符串，
    一个是压缩后消息长度TextZipLen｜长度字符串，消息内容存储在Profile对象Data中。